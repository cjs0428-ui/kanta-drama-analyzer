<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KANTA ìˆë“œë¼ë§ˆ ë¶„ì„ê¸°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #f5f3ff 0%, #fce7f3 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }
    h1 { font-size: 2.5rem; text-align: center; margin-bottom: 10px; }
    h2 { font-size: 1.5rem; margin-bottom: 20px; }
    p { text-align: center; color: #666; margin-bottom: 30px; }
    label { display: block; font-weight: 600; margin-bottom: 8px; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px; }
    button { width: 100%; padding: 15px; background: #9333ea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    button:hover { background: #7e22ce; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .file-zone { border: 2px dashed #ddd; border-radius: 8px; padding: 60px 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .file-zone:hover { border-color: #9333ea; background: #faf5ff; }
    .file-zone .icon { font-size: 4rem; margin-bottom: 20px; }
    .hidden { display: none; }
    .progress { text-align: center; padding: 40px; }
    .progress .spinner { font-size: 4rem; animation: spin 2s linear infinite; display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .result { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 20px; margin-top: 20px; white-space: pre-wrap; line-height: 1.6; }
    .info { background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px; padding: 15px; margin: 20px 0; font-size: 14px; color: #1e40af; }
    .error { background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 20px; margin: 20px 0; color: #dc2626; }
    .success { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 20px; margin: 20px 0; color: #16a34a; }
    .warning { background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px; padding: 20px; margin: 20px 0; color: #d97706; }
    .log { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    .log-item { margin: 5px 0; padding: 5px; }
    .log-info { color: #0ea5e9; }
    .log-success { color: #16a34a; }
    .log-error { color: #dc2626; }
    .log-warning { color: #d97706; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¬ KANTA ìˆë“œë¼ë§ˆ ë¶„ì„ê¸°</h1>
    <p>ì¼ë³¸ ë“œë¼ë§ˆ ëŒ€ì‚¬ë¥¼ ìë™ìœ¼ë¡œ ë²ˆì—­í•˜ê³  ë¶„ì„í•´ì„œ ê´‘ê³  ë¬¸êµ¬ë¥¼ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤</p>

    <!-- ë¡œê·¸ íŒ¨ë„ -->
    <div class="card">
      <h2>ğŸ“‹ ì‹¤í–‰ ë¡œê·¸</h2>
      <div id="logPanel" class="log">
        <div class="log-item log-info">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</div>
      </div>
    </div>

    <!-- Step 0: API í‚¤ ì…ë ¥ -->
    <div id="step0" class="card">
      <h2>ğŸ”‘ API í‚¤ ì„¤ì •</h2>
      <div class="info">
        <p style="margin: 0;">ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
        <ul style="margin-left: 20px; margin-top: 10px;">
          <li>AssemblyAI: ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜</li>
          <li>OpenAI: ë²ˆì—­, ë¶„ì„, ê´‘ê³  ìƒì„±</li>
        </ul>
      </div>
      
      <label>AssemblyAI API Key 
        <a href="https://www.assemblyai.com/dashboard" target="_blank" style="color: #9333ea; font-size: 12px;">(ë°œê¸‰ë°›ê¸° â†’)</a>
      </label>
      <input type="password" id="assemblyKey" placeholder="AssemblyAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      
      <label>OpenAI API Key 
        <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #9333ea; font-size: 12px;">(ë°œê¸‰ë°›ê¸° â†’)</a>
      </label>
      <input type="password" id="openaiKey" placeholder="OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      
      <button onclick="saveKeys()">API í‚¤ ì €ì¥í•˜ê³  ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- Step 1: ì˜ìƒ ì—…ë¡œë“œ -->
    <div id="step1" class="card hidden">
      <h2>ğŸ“¹ ì˜ìƒ ì—…ë¡œë“œ</h2>
      
      <div class="file-zone" onclick="document.getElementById('videoInput').click()">
        <div class="icon">ğŸ“</div>
        <p id="fileName" style="font-size: 18px; font-weight: 600;">í´ë¦­í•´ì„œ ì˜ìƒ ì„ íƒ</p>
        <p id="fileSize" style="font-size: 14px; color: #666;"></p>
      </div>
      <input type="file" id="videoInput" accept="video/*" class="hidden" onchange="selectFile(this)">
      
      <button id="uploadBtn" class="hidden" onclick="uploadVideo()">ì—…ë¡œë“œ ì‹œì‘</button>
      
      <div id="uploadStatus" class="hidden"></div>
    </div>

    <!-- Step 2: ì§„í–‰ ì¤‘ -->
    <div id="step2" class="card hidden">
      <div class="progress">
        <div class="spinner">â³</div>
        <h2 id="statusText">ì²˜ë¦¬ ì¤‘...</h2>
        <p id="statusDetail" style="color: #666; margin-top: 10px;"></p>
      </div>
    </div>
  </div>

  <script>
    // ë¡œê·¸ í•¨ìˆ˜
    function addLog(message, type = 'info') {
      const logPanel = document.getElementById('logPanel');
      const logItem = document.createElement('div');
      logItem.className = 'log-item log-' + type;
      const time = new Date().toLocaleTimeString();
      logItem.textContent = '[' + time + '] ' + message;
      logPanel.appendChild(logItem);
      logPanel.scrollTop = logPanel.scrollHeight;
      
      console.log('[' + type.toUpperCase() + ']', message);
    }

    addLog('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ', 'success');
    
    let apiKeys = { assemblyAI: '', openAI: '' };
    let selectedFile = null;

    function saveKeys() {
      addLog('API í‚¤ ì €ì¥ ì‹œë„...', 'info');
      
      const assemblyKey = document.getElementById('assemblyKey').value.trim();
      const openaiKey = document.getElementById('openaiKey').value.trim();
      
      if (!assemblyKey || !openaiKey) {
        addLog('API í‚¤ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
        alert('ë‘ ê°œì˜ API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      apiKeys.assemblyAI = assemblyKey;
      apiKeys.openAI = openaiKey;
      
      addLog('API í‚¤ ì €ì¥ ì™„ë£Œ', 'success');
      addLog('AssemblyAI í‚¤ ê¸¸ì´: ' + assemblyKey.length + 'ì', 'info');
      addLog('OpenAI í‚¤ ê¸¸ì´: ' + openaiKey.length + 'ì', 'info');
      
      document.getElementById('step0').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
      
      addLog('ì˜ìƒ ì—…ë¡œë“œ ë‹¨ê³„ë¡œ ì´ë™', 'info');
    }

    function selectFile(input) {
      const file = input.files[0];
      if (!file) {
        addLog('íŒŒì¼ ì„ íƒ ì·¨ì†Œ', 'warning');
        return;
      }
      
      addLog('íŒŒì¼ ì„ íƒë¨: ' + file.name, 'info');
      addLog('íŒŒì¼ íƒ€ì…: ' + file.type, 'info');
      addLog('íŒŒì¼ í¬ê¸°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB', 'info');
      
      if (!file.type.startsWith('video/')) {
        addLog('ë¹„ë””ì˜¤ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤: ' + file.type, 'error');
        alert('ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (file.size > 500 * 1024 * 1024) {
        addLog('íŒŒì¼ í¬ê¸° ì´ˆê³¼: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB', 'error');
        alert('íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. 500MB ì´í•˜ì˜ ì˜ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      selectedFile = file;
      
      document.getElementById('fileName').textContent = 'âœ… ' + file.name;
      document.getElementById('fileSize').textContent = 'í¬ê¸°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB';
      document.getElementById('uploadBtn').classList.remove('hidden');
      
      addLog('íŒŒì¼ ê²€ì¦ ì™„ë£Œ, ì—…ë¡œë“œ ê°€ëŠ¥', 'success');
    }

    async function uploadVideo() {
      if (!selectedFile) {
        addLog('íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
        alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      addLog('=== ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ ===', 'info');
      addLog('íŒŒì¼ëª…: ' + selectedFile.name, 'info');
      addLog('í¬ê¸°: ' + selectedFile.size + ' bytes', 'info');
      
      const uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';
      
      const statusDiv = document.getElementById('uploadStatus');
      statusDiv.className = 'warning';
      statusDiv.textContent = 'ğŸ“¤ ì—…ë¡œë“œ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
      statusDiv.classList.remove('hidden');
      
      try {
        addLog('Vercel Blob Storageë¡œ ì—…ë¡œë“œ ìš”ì²­ ì¤€ë¹„', 'info');
        addLog('API ì—”ë“œí¬ì¸íŠ¸: /api/upload-blob', 'info');
        
        const url = '/api/upload-blob?assemblyAIKey=' + encodeURIComponent(apiKeys.assemblyAI);
        addLog('ìš”ì²­ URL ìƒì„± ì™„ë£Œ', 'info');
        
        addLog('fetch ìš”ì²­ ì‹œì‘...', 'info');
        const startTime = Date.now();
        
        const response = await fetch(url, {
          method: 'POST',
          body: selectedFile,
          headers: {
            'Content-Type': selectedFile.type
          }
        });
        
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        addLog('fetch ì‘ë‹µ ë°›ìŒ (ì†Œìš”ì‹œê°„: ' + elapsed + 'ì´ˆ)', 'info');
        addLog('ì‘ë‹µ ìƒíƒœ: ' + response.status + ' ' + response.statusText, 'info');
        
        if (!response.ok) {
          addLog('HTTP ì—ëŸ¬ ë°œìƒ: ' + response.status, 'error');
          
          let errorData;
          try {
            errorData = await response.json();
            addLog('ì—ëŸ¬ ë°ì´í„°: ' + JSON.stringify(errorData), 'error');
          } catch (e) {
            const errorText = await response.text();
            addLog('ì—ëŸ¬ í…ìŠ¤íŠ¸: ' + errorText, 'error');
            errorData = { error: errorText };
          }
          
          statusDiv.className = 'error';
          statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          
          throw new Error(errorData.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨ (HTTP ' + response.status + ')');
        }
        
        addLog('ì‘ë‹µ JSON íŒŒì‹± ì¤‘...', 'info');
        const data = await response.json();
        addLog('ì‘ë‹µ ë°ì´í„°: ' + JSON.stringify(data), 'success');
        
        if (!data.success) {
          addLog('ì—…ë¡œë“œ ì‹¤íŒ¨ ì‘ë‹µ: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
          statusDiv.className = 'error';
          statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          throw new Error(data.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        }
        
        addLog('ì—…ë¡œë“œ ì„±ê³µ!', 'success');
        addLog('Blob URL: ' + data.blobUrl, 'success');
        addLog('Transcription ID: ' + data.transcriptionId, 'success');
        
        statusDiv.className = 'success';
        statusDiv.textContent = 'âœ… ì—…ë¡œë“œ ì™„ë£Œ! ìŒì„± ì¸ì‹ì„ ì‹œì‘í•©ë‹ˆë‹¤...';
        
        setTimeout(() => {
          alert('ì—…ë¡œë“œ ì„±ê³µ!\n\nì´ì œ ìŒì„± ì¸ì‹ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.\n(ì‹¤ì œ êµ¬í˜„ì€ API ì—°ë™ í›„ ì™„ì„±ë©ë‹ˆë‹¤)');
        }, 500);
        
      } catch (error) {
        addLog('=== ì—…ë¡œë“œ ì‹¤íŒ¨ ===', 'error');
        addLog('ì—ëŸ¬ íƒ€ì…: ' + error.name, 'error');
        addLog('ì—ëŸ¬ ë©”ì‹œì§€: ' + error.message, 'error');
        addLog('ì—ëŸ¬ ìŠ¤íƒ: ' + error.stack, 'error');
        
        statusDiv.className = 'error';
        statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message;
        
        alert('ì—…ë¡œë“œ ì‹¤íŒ¨\n\n' + error.message + '\n\nìì„¸í•œ ë‚´ìš©ì€ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'ë‹¤ì‹œ ì‹œë„';
      }
    }
    
    addLog('ëª¨ë“  í•¨ìˆ˜ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
  </script>
</body>
</html>
