<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KANTA ìˆë“œë¼ë§ˆ ë¶„ì„ê¸°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #f5f3ff 0%, #fce7f3 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }
    h1 { font-size: 2.5rem; text-align: center; margin-bottom: 10px; }
    h2 { font-size: 1.5rem; margin-bottom: 20px; }
    p { text-align: center; color: #666; margin-bottom: 30px; }
    label { display: block; font-weight: 600; margin-bottom: 8px; }
    input[type="password"], input[type="text"], select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px; }
    button { width: 100%; padding: 15px; background: #9333ea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    button:hover:not(:disabled) { background: #7e22ce; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .file-zone { border: 2px dashed #ddd; border-radius: 8px; padding: 60px 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .file-zone:hover { border-color: #9333ea; background: #faf5ff; }
    .file-zone .icon { font-size: 4rem; margin-bottom: 20px; }
    .hidden { display: none; }
    .info { background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px; padding: 15px; margin: 20px 0; font-size: 14px; color: #1e40af; }
    .error { background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 20px; margin: 20px 0; color: #dc2626; }
    .success { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 20px; margin: 20px 0; color: #16a34a; }
    .warning { background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px; padding: 20px; margin: 20px 0; color: #d97706; }
    .log { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    .log-item { margin: 5px 0; padding: 5px; }
    .log-info { color: #0ea5e9; }
    .log-success { color: #16a34a; }
    .log-error { color: #dc2626; }
    .log-warning { color: #d97706; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¬ KANTA ìˆë“œë¼ë§ˆ ë¶„ì„ê¸°</h1>
    <p>ì¼ë³¸ ë“œë¼ë§ˆ ëŒ€ì‚¬ë¥¼ ìë™ìœ¼ë¡œ ë²ˆì—­í•˜ê³  ë¶„ì„í•´ì„œ ê´‘ê³  ë¬¸êµ¬ë¥¼ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤</p>

    <!-- ë¡œê·¸ íŒ¨ë„ -->
    <div class="card">
      <h2>ğŸ“‹ ì‹¤í–‰ ë¡œê·¸</h2>
      <div id="logPanel" class="log"></div>
      <button id="clearLogBtn" style="margin-top: 10px; background: #6b7280;">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>

    <!-- Step 0: API í‚¤ ì…ë ¥ -->
    <div id="step0" class="card">
      <h2>ğŸ”‘ API í‚¤ ì„¤ì •</h2>
      <div class="info">
        <p style="margin: 0;">ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
      </div>
      
      <label>AssemblyAI API Key</label>
      <input type="password" id="assemblyKey" placeholder="AssemblyAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      
      <label>OpenAI API Key</label>
      <input type="password" id="openaiKey" placeholder="OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      
      <button id="saveKeysBtn">API í‚¤ ì €ì¥í•˜ê³  ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- Step 1: ì˜ìƒ ì—…ë¡œë“œ -->
    <div id="step1" class="card hidden">
      <h2>ğŸ“¹ ì˜ìƒ ì—…ë¡œë“œ</h2>
      
      <div class="file-zone" id="fileZone">
        <div class="icon">ğŸ“</div>
        <p id="fileName" style="font-size: 18px; font-weight: 600;">í´ë¦­í•´ì„œ ì˜ìƒ ì„ íƒ</p>
        <p id="fileSize" style="font-size: 14px; color: #666;"></p>
      </div>
      <input type="file" id="videoInput" accept="video/*" style="display: none;">
      
      <button id="uploadBtn" class="hidden">ì—…ë¡œë“œ ì‹œì‘</button>
      
      <div id="uploadStatus" class="hidden"></div>
    </div>
  </div>

  <script>
    console.log('ğŸŸ¢ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
    
    // ë¡œê·¸ í•¨ìˆ˜
    function addLog(message, type) {
      const logPanel = document.getElementById('logPanel');
      const logItem = document.createElement('div');
      logItem.className = 'log-item log-' + (type || 'info');
      const time = new Date().toLocaleTimeString();
      logItem.textContent = '[' + time + '] ' + message;
      logPanel.appendChild(logItem);
      logPanel.scrollTop = logPanel.scrollHeight;
      console.log('[' + (type || 'info').toUpperCase() + ']', message);
    }

    addLog('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘', 'info');
    
    // ì „ì—­ ë³€ìˆ˜
    let apiKeys = { assemblyAI: '', openAI: '' };
    let selectedFile = null;

    // DOM ìš”ì†Œ
    const saveKeysBtn = document.getElementById('saveKeysBtn');
    const step0 = document.getElementById('step0');
    const step1 = document.getElementById('step1');
    const fileZone = document.getElementById('fileZone');
    const videoInput = document.getElementById('videoInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const clearLogBtn = document.getElementById('clearLogBtn');
    
    addLog('DOM ìš”ì†Œ ì°¸ì¡° ì™„ë£Œ', 'success');

    // ë¡œê·¸ ì§€ìš°ê¸°
    clearLogBtn.addEventListener('click', function() {
      document.getElementById('logPanel').innerHTML = '';
      addLog('ë¡œê·¸ ì´ˆê¸°í™”ë¨', 'info');
    });

    // API í‚¤ ì €ì¥
    saveKeysBtn.addEventListener('click', function() {
      addLog('API í‚¤ ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨', 'info');
      
      const assemblyKey = document.getElementById('assemblyKey').value.trim();
      const openaiKey = document.getElementById('openaiKey').value.trim();
      
      if (!assemblyKey || !openaiKey) {
        addLog('API í‚¤ ì…ë ¥ ëˆ„ë½', 'error');
        alert('ë‘ ê°œì˜ API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      apiKeys.assemblyAI = assemblyKey;
      apiKeys.openAI = openaiKey;
      
      addLog('API í‚¤ ì €ì¥ ì™„ë£Œ', 'success');
      addLog('AssemblyAI í‚¤ ê¸¸ì´: ' + assemblyKey.length, 'info');
      addLog('OpenAI í‚¤ ê¸¸ì´: ' + openaiKey.length, 'info');
      
      step0.classList.add('hidden');
      step1.classList.remove('hidden');
      
      addLog('ì˜ìƒ ì—…ë¡œë“œ í™”ë©´ìœ¼ë¡œ ì „í™˜', 'success');
    });

    // íŒŒì¼ ì„ íƒ ì˜ì—­ í´ë¦­
    fileZone.addEventListener('click', function() {
      addLog('íŒŒì¼ ì„ íƒ ì˜ì—­ í´ë¦­ë¨', 'info');
      videoInput.click();
      addLog('íŒŒì¼ ì„ íƒ ëŒ€í™”ìƒì ì—´ë¦¼', 'info');
    });

    // íŒŒì¼ ì„ íƒ
    videoInput.addEventListener('change', function(event) {
      addLog('íŒŒì¼ ì…ë ¥ change ì´ë²¤íŠ¸ ë°œìƒ', 'info');
      
      const file = event.target.files[0];
      
      if (!file) {
        addLog('íŒŒì¼ ì„ íƒ ì·¨ì†Œë¨', 'warning');
        return;
      }
      
      addLog('íŒŒì¼ì´ ì„ íƒë¨!', 'success');
      addLog('íŒŒì¼ëª…: ' + file.name, 'info');
      addLog('íŒŒì¼ íƒ€ì…: ' + file.type, 'info');
      addLog('íŒŒì¼ í¬ê¸°: ' + file.size + ' bytes (' + (file.size / 1024 / 1024).toFixed(2) + ' MB)', 'info');
      
      // ë¹„ë””ì˜¤ íŒŒì¼ ê²€ì¦
      if (!file.type.startsWith('video/')) {
        addLog('ë¹„ë””ì˜¤ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤: ' + file.type, 'error');
        alert('ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\nì„ íƒí•œ íŒŒì¼ íƒ€ì…: ' + file.type);
        return;
      }
      
      // í¬ê¸° ê²€ì¦
      const maxSize = 500 * 1024 * 1024; // 500MB
      if (file.size > maxSize) {
        addLog('íŒŒì¼ í¬ê¸° ì´ˆê³¼: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB', 'error');
        alert('íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤.\n\nìµœëŒ€ í¬ê¸°: 500MB\ní˜„ì¬ í¬ê¸°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB');
        return;
      }
      
      // íŒŒì¼ ì €ì¥
      selectedFile = file;
      
      // UI ì—…ë°ì´íŠ¸
      document.getElementById('fileName').textContent = 'âœ… ' + file.name;
      document.getElementById('fileSize').textContent = 'í¬ê¸°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB';
      uploadBtn.classList.remove('hidden');
      
      addLog('íŒŒì¼ ê²€ì¦ ì™„ë£Œ! ì—…ë¡œë“œ ì¤€ë¹„ë¨', 'success');
    });

    // ì—…ë¡œë“œ ë²„íŠ¼
    uploadBtn.addEventListener('click', async function() {
      addLog('=== ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ===', 'info');
      
      if (!selectedFile) {
        addLog('ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
        alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';
      
      const statusDiv = document.getElementById('uploadStatus');
      statusDiv.className = 'warning';
      statusDiv.textContent = 'ğŸ“¤ ì—…ë¡œë“œ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
      statusDiv.classList.remove('hidden');
      
      addLog('ì—…ë¡œë“œ ì‹œì‘: ' + selectedFile.name, 'info');
      
      try {
        const url = '/api/upload-blob?assemblyAIKey=' + encodeURIComponent(apiKeys.assemblyAI);
        addLog('ìš”ì²­ URL: ' + url, 'info');
        
        addLog('fetch ìš”ì²­ ì‹œì‘...', 'info');
        const startTime = Date.now();
        
        const response = await fetch(url, {
          method: 'POST',
          body: selectedFile,
          headers: {
            'Content-Type': selectedFile.type
          }
        });
        
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        addLog('ì‘ë‹µ ìˆ˜ì‹  (ì†Œìš”ì‹œê°„: ' + elapsed + 'ì´ˆ)', 'info');
        addLog('HTTP ìƒíƒœ: ' + response.status + ' ' + response.statusText, response.ok ? 'success' : 'error');
        
        if (!response.ok) {
          let errorMsg;
          try {
            const errorData = await response.json();
            errorMsg = errorData.error || errorData.message || 'HTTP ' + response.status;
            addLog('ì—ëŸ¬ ì‘ë‹µ: ' + JSON.stringify(errorData), 'error');
          } catch (e) {
            errorMsg = await response.text();
            addLog('ì—ëŸ¬ í…ìŠ¤íŠ¸: ' + errorMsg, 'error');
          }
          
          statusDiv.className = 'error';
          statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + errorMsg;
          
          throw new Error(errorMsg);
        }
        
        const data = await response.json();
        addLog('ì‘ë‹µ ë°ì´í„°: ' + JSON.stringify(data), 'success');
        
        if (!data.success) {
          addLog('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
          statusDiv.className = 'error';
          statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          throw new Error(data.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        }
        
        addLog('âœ… ì—…ë¡œë“œ ì„±ê³µ!', 'success');
        addLog('Blob URL: ' + data.blobUrl, 'success');
        
        statusDiv.className = 'success';
        statusDiv.textContent = 'âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n\nBlob URL: ' + data.blobUrl;
        
        alert('ì—…ë¡œë“œ ì„±ê³µ!\n\níŒŒì¼ì´ Vercel Blob Storageì— ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        
      } catch (error) {
        addLog('=== ì—…ë¡œë“œ ì‹¤íŒ¨ ===', 'error');
        addLog('ì—ëŸ¬: ' + error.message, 'error');
        
        statusDiv.className = 'error';
        statusDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨\n\n' + error.message;
        
        alert('ì—…ë¡œë“œ ì‹¤íŒ¨\n\n' + error.message + '\n\në¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'ë‹¤ì‹œ ì‹œë„';
      }
    });
    
    addLog('ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ', 'success');
    addLog('ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ âœ…', 'success');
  </script>
</body>
</html>
